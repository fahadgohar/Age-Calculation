<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Fahad's Age Calculation</title>
  <meta name="theme-color" content="#111111" />
  <style>
    :root{
      --bg:#f6f7fb; --card:#ffffff; --text:#111; --muted:#555;
      --line:#e5e7eb; --soft:#f3f4f6; --btn:#111; --btnText:#fff;
      --shadow: 0 6px 18px rgba(0,0,0,.08);
      --danger:#b00020;
    }
    [data-theme="dark"] body::before {
  background: rgba(0, 0, 0, 0.65);
}
{
      --bg:#0b0f19; --card:#121826; --text:#f3f4f6; --muted:#b9c0cc;
      --line:#263043; --soft:#0f1626; --btn:#f3f4f6; --btnText:#111;
      --shadow: 0 10px 28px rgba(0,0,0,.35);
      --danger:#ff5c5c;
    }
    body {
  font-family: system-ui, Arial, sans-serif;
  margin:0;
  color:var(--text);
  background-image: url("https://images.unsplash.com/photo-1501785888041-af3ef285b470?q=80&w=2000&auto=format&fit=crop");
  background-size: cover;
  background-position: center;
  background-attachment: fixed;
  position: relative;
}

/* Dark overlay for readability */
body::before {
  content: "";
  position: fixed;
  inset: 0;
  background: rgba(0, 0, 0, 0.45);
  z-index: -1;
}

    .wrap { max-width: 920px; margin: 24px auto; padding: 16px; }
    .card {
  background: rgba(255,255,255,0.92);
  backdrop-filter: blur(6px);
  border-radius:18px;
  padding:18px;
  box-shadow: 0 12px 40px rgba(0,0,0,.35);
}
var(--card); border-radius:18px; padding:18px; box-shadow:var(--shadow); border:1px solid rgba(0,0,0,.02); }
    h1 { margin:0; font-size: 22px; letter-spacing:.2px; }
    .sub { margin:6px 0 14px; color:var(--muted); }
    .topbar{ display:flex; align-items:flex-start; justify-content:space-between; gap:10px; flex-wrap:wrap; }
    .toggle{
      display:flex; align-items:center; gap:10px; user-select:none;
      border:1px solid var(--line); background:transparent; color:var(--text);
      padding:10px 12px; border-radius:14px; cursor:pointer;
    }
    .infoBar{
      margin-top:10px;
      display:flex; gap:10px; flex-wrap:wrap;
      color:var(--muted); font-size:13px;
    }
    .badge{
      border:1px solid var(--line);
      background:transparent;
      padding:8px 10px;
      border-radius:999px;
    }

    .grid{ display:grid; grid-template-columns:1fr; gap:12px; margin-top:12px; }
    @media (min-width: 720px){ .grid{ grid-template-columns: 1fr 1fr; } }
    label { display:block; font-weight:650; margin: 10px 0 6px; }
    input { width:100%; padding:12px; border:1px solid var(--line); border-radius:14px; font-size:16px; background:transparent; color:var(--text); }
    input::placeholder{ color: #9aa3b2; }

    .actions{ display:flex; gap:10px; flex-wrap:wrap; margin-top:12px; }
    button { padding:12px 14px; border:0; border-radius:14px; font-size:16px; font-weight:750; cursor:pointer; }
    .primary{ background:var(--btn); color:var(--btnText); flex:1; min-width: 200px; }
    .secondary{ background:transparent; color:var(--text); border:1px solid var(--line); }
    .danger{ background:transparent; color:var(--danger); border:1px solid var(--danger); }
    button:active { transform: scale(.99); }

    .error { color:var(--danger); font-weight:800; margin-top:10px; display:none; }

    .result { margin-top:16px; padding:14px; border-radius:14px; background:var(--soft); border:1px solid var(--line); }
    .row { display:flex; gap:12px; flex-wrap:wrap; }
    .pill { background:var(--card); border:1px solid var(--line); border-radius:14px; padding:12px; flex:1; min-width: 240px; }
    .k { color:var(--muted); font-size:13px; }
    .v { font-size:20px; font-weight:900; margin-top:6px; }
    .mini { font-size:14px; font-weight:800; }
    .muted { color:var(--muted); font-size:13px; margin-top:10px; }
    .nameTag{ font-weight:900; }

    .history{
      margin-top:14px;
      border:1px solid var(--line);
      border-radius:14px;
      overflow:hidden;
      background:var(--card);
    }
    .historyHead{
      display:flex; align-items:center; justify-content:space-between; gap:10px;
      padding:12px 12px;
      background:transparent;
      border-bottom:1px solid var(--line);
    }
    .historyHead .title{ font-weight:850; }
    .historyList{ padding:8px; }
    .hItem{
      display:flex; align-items:center; justify-content:space-between; gap:10px;
      padding:10px;
      border-radius:12px;
      border:1px solid var(--line);
      margin:8px 0;
      background:transparent;
    }
    .hLeft{ display:flex; flex-direction:column; gap:4px; }
    .hName{ font-weight:850; }
    .hMeta{ font-size:12px; color:var(--muted); }
    .hBtns{ display:flex; gap:8px; flex-wrap:wrap; }
    .smallBtn{
      padding:9px 10px; border-radius:12px; font-size:13px; font-weight:800;
      border:1px solid var(--line); background:transparent; color:var(--text);
      cursor:pointer;
    }
    .smallDanger{ border:1px solid var(--danger); color:var(--danger); }
    footer { margin-top:12px; color:var(--muted); font-size:12px; text-align:center; }
  </style>
</head>

<body>
  <div class="wrap">
    <div class="card">
      <div class="topbar">
        <div>
          <h1>Fahad's Age Calculation</h1>
          <div class="sub">Age calculator using todayâ€™s date. Includes history + dark mode + timezone.</div>

          <div class="infoBar">
            <div class="badge">Time zone: <b id="tz"></b></div>
            <div class="badge">Local time now: <b id="now"></b></div>
            <div class="badge">Local date used: <b id="todayUsed"></b></div>
          </div>
        </div>

        <button id="themeBtn" class="toggle" type="button" title="Toggle dark mode">
          <span id="themeIcon">ðŸŒ™</span>
          <span id="themeText">Dark</span>
        </button>
      </div>

      <div class="grid">
        <div>
          <label for="personName">Name</label>
          <input id="personName" type="text" placeholder="Enter name (recommended)" />
        </div>
        <div>
          <label for="dob">Date of Birth</label>
          <input id="dob" type="date" />
        </div>
      </div>

      <div class="actions">
        <button id="calcBtn" class="primary" type="button">Calculate & Save to History</button>
        <button id="clearInputsBtn" class="secondary" type="button">Clear Inputs</button>
      </div>

      <div id="err" class="error"></div>

      <div id="out" class="result" style="display:none;">
        <div class="muted" id="helloLine"></div>

        <div class="row" style="margin-top:10px;">
          <div class="pill">
            <div class="k">Age (Years)</div>
            <div id="years" class="v">0</div>
            <div class="k">Extra Days after last birthday</div>
            <div id="extraDays" class="v mini">0</div>
          </div>

          <div class="pill">
            <div class="k">Total Time Lived</div>
            <div class="k" style="margin-top:10px;">Months (approx.)</div>
            <div id="months" class="v mini">0</div>
            <div class="k">Weeks (approx.)</div>
            <div id="weeks" class="v mini">0</div>
            <div class="k">Days</div>
            <div id="days" class="v mini">0</div>
          </div>

          <div class="pill">
            <div class="k">Time (derived from total days)</div>
            <div class="k" style="margin-top:10px;">Hours</div>
            <div id="hours" class="v mini">0</div>
            <div class="k">Minutes</div>
            <div id="minutes" class="v mini">0</div>
            <div class="k">Seconds</div>
            <div id="seconds" class="v mini">0</div>
          </div>
        </div>

        <div class="muted" id="note"></div>
      </div>

      <div class="history">
        <div class="historyHead">
          <div class="title">History (saved on this device)</div>
          <button id="clearHistoryBtn" class="smallBtn smallDanger" type="button">Clear All</button>
        </div>
        <div id="historyList" class="historyList"></div>
      </div>

      <footer>Â© Fahad's Age Calculation</footer>
    </div>
  </div>

<script>
  // ===================== Theme =====================
  const THEME_KEY = "fahad_theme";
  function setTheme(mode){
    document.documentElement.setAttribute("data-theme", mode);
    localStorage.setItem(THEME_KEY, mode);
    const isDark = mode === "dark";
    document.getElementById("themeIcon").textContent = isDark ? "â˜€ï¸" : "ðŸŒ™";
    document.getElementById("themeText").textContent = isDark ? "Light" : "Dark";
    document.querySelector('meta[name="theme-color"]').setAttribute("content", isDark ? "#0b0f19" : "#111111");
  }
  function initTheme(){
    const saved = localStorage.getItem(THEME_KEY);
    setTheme(saved || "light");
  }
  document.getElementById("themeBtn").addEventListener("click", () => {
    const cur = document.documentElement.getAttribute("data-theme") || "light";
    setTheme(cur === "dark" ? "light" : "dark");
  });

  // ===================== Time zone / today =====================
  function pad2(n){ return String(n).padStart(2,"0"); }
  function getDeviceTimeZone(){
    return Intl.DateTimeFormat().resolvedOptions().timeZone || "Unknown";
  }
  function getLocalNowString(){
    const d = new Date();
    return `${d.getFullYear()}-${pad2(d.getMonth()+1)}-${pad2(d.getDate())} ${pad2(d.getHours())}:${pad2(d.getMinutes())}:${pad2(d.getSeconds())}`;
  }
  function getLocalDateOnlyString(){
    const d = new Date();
    return `${d.getFullYear()}-${pad2(d.getMonth()+1)}-${pad2(d.getDate())}`;
  }

  // We use date-only in local time, then convert to UTC midnight for stable day difference math.
  function localDateStringToUTC(dateStr){
    const [y,m,dd] = dateStr.split("-").map(Number);
    return new Date(Date.UTC(y, m-1, dd));
  }

  // ===================== Age math =====================
  function daysBetweenUTC(a, b) {
    const ms = b.getTime() - a.getTime();
    return Math.floor(ms / (1000 * 60 * 60 * 24));
  }
  function addYearsUTC(dateUTC, years) {
    const y = dateUTC.getUTCFullYear() + years;
    const m = dateUTC.getUTCMonth();
    const d = dateUTC.getUTCDate();
    const candidate = new Date(Date.UTC(y, m, d));
    if (candidate.getUTCMonth() !== m) {
      return new Date(Date.UTC(y, m, 0)); // handles Feb 29 -> Feb 28
    }
    return candidate;
  }
  function calculateAge(dobUTC, asOfUTC) {
    if (asOfUTC.getTime() < dobUTC.getTime()) {
      throw new Error("Today cannot be before date of birth.");
    }

    const totalDays = daysBetweenUTC(dobUTC, asOfUTC);

    let years = asOfUTC.getUTCFullYear() - dobUTC.getUTCFullYear();
    let thisYearBday = addYearsUTC(dobUTC, years);
    if (thisYearBday.getTime() > asOfUTC.getTime()) {
      years--;
      thisYearBday = addYearsUTC(dobUTC, years);
    }

    const extraDays = daysBetweenUTC(thisYearBday, asOfUTC);

    const monthsApprox = totalDays / 30.4375;
    const weeksApprox = totalDays / 7;

    const hours = totalDays * 24;
    const minutes = hours * 60;
    const seconds = minutes * 60;

    return {
      years, extraDays, totalDays,
      monthsApprox, weeksApprox,
      hours, minutes, seconds,
      lastBirthdayUTC: thisYearBday
    };
  }

  // ===================== Storage (History) =====================
  const HISTORY_KEY = "fahad_history_v1";

  function loadHistory(){
    try{
      const raw = localStorage.getItem(HISTORY_KEY);
      return raw ? JSON.parse(raw) : [];
    }catch(_){ return []; }
  }
  function saveHistory(items){
    localStorage.setItem(HISTORY_KEY, JSON.stringify(items));
  }

  function upsertHistory(entry){
    const items = loadHistory();
    const key = (entry.name || "").trim().toLowerCase() + "|" + entry.dob;
    const idx = items.findIndex(x => ((x.name||"").trim().toLowerCase() + "|" + x.dob) === key);
    if (idx >= 0) items[idx] = entry; else items.unshift(entry);
    // keep max 50
    saveHistory(items.slice(0,50));
  }

  function deleteHistoryItem(id){
    const items = loadHistory().filter(x => x.id !== id);
    saveHistory(items);
  }

  // ===================== UI =====================
  function escapeHtml(s){
    return s.replace(/[&<>"']/g, (c) => ({
      "&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#039;"
    }[c]));
  }
  function showError(msg) {
    const err = document.getElementById("err");
    err.textContent = msg;
    err.style.display = "block";
    document.getElementById("out").style.display = "none";
  }
  function clearError() {
    const err = document.getElementById("err");
    err.textContent = "";
    err.style.display = "none";
  }

  function renderResult(name, dob, r, todayStr){
    document.getElementById("helloLine").innerHTML =
      name ? `Result for <span class="nameTag">${escapeHtml(name)}</span>:` : `Result:`;

    document.getElementById("years").textContent = r.years;
    document.getElementById("extraDays").textContent = r.extraDays;

    document.getElementById("days").textContent = r.totalDays.toLocaleString();
    document.getElementById("weeks").textContent = r.weeksApprox.toFixed(2);
    document.getElementById("months").textContent = r.monthsApprox.toFixed(2);

    document.getElementById("hours").textContent = r.hours.toLocaleString();
    document.getElementById("minutes").textContent = r.minutes.toLocaleString();
    document.getElementById("seconds").textContent = r.seconds.toLocaleString();

    const lastBday = `${r.lastBirthdayUTC.getUTCFullYear()}-${pad2(r.lastBirthdayUTC.getUTCMonth()+1)}-${pad2(r.lastBirthdayUTC.getUTCDate())}`;
    document.getElementById("note").textContent =
      `DOB: ${dob} | Today used: ${todayStr} | Last birthday: ${lastBday}`;

    document.getElementById("out").style.display = "block";
  }

  function renderHistory(){
    const list = document.getElementById("historyList");
    const items = loadHistory();
    if(items.length === 0){
      list.innerHTML = `<div class="muted" style="padding:10px;">No saved people yet.</div>`;
      return;
    }

    list.innerHTML = items.map(item => `
      <div class="hItem">
        <div class="hLeft">
          <div class="hName">${escapeHtml(item.name || "Unnamed")}</div>
          <div class="hMeta">DOB: ${escapeHtml(item.dob)} â€¢ Saved: ${escapeHtml(item.savedAt)}</div>
        </div>
        <div class="hBtns">
          <button class="smallBtn" onclick="window.__loadItem('${item.id}')">Load</button>
          <button class="smallBtn smallDanger" onclick="window.__deleteItem('${item.id}')">Delete</button>
        </div>
      </div>
    `).join("");
  }

  window.__loadItem = function(id){
    const item = loadHistory().find(x => x.id === id);
    if(!item) return;

    document.getElementById("personName").value = item.name || "";
    document.getElementById("dob").value = item.dob || "";

    // Recalculate with today
    const todayStr = getLocalDateOnlyString();
    const asOfUTC = localDateStringToUTC(todayStr);
    const dobUTC = localDateStringToUTC(item.dob);

    const r = calculateAge(dobUTC, asOfUTC);
    renderResult(item.name, item.dob, r, todayStr);
    clearError();
    window.scrollTo({ top: 0, behavior: "smooth" });
  }

  window.__deleteItem = function(id){
    deleteHistoryItem(id);
    renderHistory();
  }

  // ===================== Events =====================
  document.getElementById("calcBtn").addEventListener("click", () => {
    clearError();

    const name = document.getElementById("personName").value.trim();
    const dob = document.getElementById("dob").value;

    if(!name) return showError("Please enter a name (so it can be saved to history).");
    if(!dob) return showError("Please select a Date of Birth.");

    const todayStr = getLocalDateOnlyString(); // local date (region)
    const asOfUTC = localDateStringToUTC(todayStr);
    const dobUTC = localDateStringToUTC(dob);

    try{
      const r = calculateAge(dobUTC, asOfUTC);
      renderResult(name, dob, r, todayStr);

      upsertHistory({
        id: crypto.randomUUID ? crypto.randomUUID() : String(Date.now()) + Math.random().toString(16).slice(2),
        name, dob,
        savedAt: getLocalNowString(),
      });

      renderHistory();
    }catch(e){
      showError(e.message || "Something went wrong.");
    }
  });

  document.getElementById("clearInputsBtn").addEventListener("click", () => {
    document.getElementById("personName").value = "";
    document.getElementById("dob").value = "";
    clearError();
    document.getElementById("out").style.display = "none";
  });

  document.getElementById("clearHistoryBtn").addEventListener("click", () => {
    localStorage.removeItem(HISTORY_KEY);
    renderHistory();
  });

  // ===================== Init =====================
  initTheme();

  document.getElementById("tz").textContent = getDeviceTimeZone();
  document.getElementById("now").textContent = getLocalNowString();
  const todayStr = getLocalDateOnlyString();
  document.getElementById("todayUsed").textContent = todayStr;

  // live clock update
  setInterval(() => {
    document.getElementById("now").textContent = getLocalNowString();
    const t = getLocalDateOnlyString();
    document.getElementById("todayUsed").textContent = t;
  }, 1000);

  renderHistory();
</script>
</body>
</html>





